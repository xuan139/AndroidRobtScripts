<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>æ—…æ¸¸ä¸ç¾é£Ÿæ¨è</title>
  <script src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    main {
      max-width: 960px;
      padding: 20px;
    }
    .card {
      border: 1px solid #ccc;
      border-radius: 10px;
      margin-bottom: 20px;
      padding: 15px;
      box-shadow: 2px 2px 10px rgba(0,0,0,0.1);
    }
    .card img {
      width: 100%;
      border-radius: 8px;
    }
    #media-section {
      margin-top: 40px;
      text-align: center;
    }
    video, canvas {
      width: 320px;
      height: 240px;
      border-radius: 10px;
    }
    #controls {
      margin-top: 10px;
    }
    #startRecording, #stopRecording {
      font-size: 1.2em;
      padding: 10px 20px;
      margin: 0 10px;
    }
    @media (min-width: 768px) {
      #media-wrapper {
        display: flex;
        justify-content: center;
        gap: 20px;
      }
    }
  </style>
</head>
<body>

<main>
  <h1>æ¬¢è¿æ¥åˆ°ç¾é£Ÿä¸æ—…è¡Œæ¨è</h1>

  <div class="card">
    <h2>æ¨èé¤é¦†ï¼šè€å¼ ç‰›è‚‰é¢</h2>
    <img src="https://source.unsplash.com/640x360/?noodles" alt="ç‰›è‚‰é¢" />
    <p>æ‹›ç‰Œç‰›è‚‰æ‹‰é¢ï¼Œæ±¤é²œè‚‰å«©ï¼Œæ·±å—æœ¬åœ°äººå–œçˆ±ã€‚</p>
  </div>

  <div class="card">
    <h2>å¿…å»æ™¯ç‚¹ï¼šé’å±±æ¹–</h2>
    <img src="https://source.unsplash.com/640x360/?lake" alt="é’å±±æ¹–" />
    <p>æ¹–å…‰å±±è‰²ï¼Œé€‚åˆæ•£æ­¥å’Œé‡é¤ï¼Œæ‘„å½±çˆ±å¥½è€…çš„å¤©å ‚ã€‚</p>
  </div>
</main>

<section id="media-section">
  <h2>äººè„¸æ£€æµ‹ä¸éŸ³é¢‘å½•åˆ¶</h2>
  <div id="media-wrapper">
    <video id="camera" autoplay muted playsinline></video>
    <canvas id="overlay"></canvas>
  </div>
  <p id="status">çŠ¶æ€ï¼šç­‰å¾…æ‘„åƒå¤´æƒé™...</p>
  <div id="controls">
    <button id="startRecording" disabled>ğŸ™ï¸ å¼€å§‹å½•éŸ³</button>
    <button id="stopRecording" disabled>ğŸ›‘ åœæ­¢å½•éŸ³</button>
    <br /><br />
    <audio id="audio" controls></audio>
  </div>
</section>

<script>
  const camera = document.getElementById('camera');
  const overlay = document.getElementById('overlay');
  const context = overlay.getContext('2d');
  const status = document.getElementById('status');
  const startButton = document.getElementById('startRecording');
  const stopButton = document.getElementById('stopRecording');
  const audioElement = document.getElementById('audio');
  let mediaRecorder;
  let audioChunks = [];

  Promise.all([
    faceapi.nets.tinyFaceDetector.loadFromUri('https://justadudewhohacks.github.io/face-api.js/models')
  ])
  .then(() => navigator.mediaDevices.getUserMedia({ video: true, audio: true }))
  .then((stream) => {
    camera.srcObject = stream;
    camera.onloadedmetadata = () => {
      camera.play();
      startFaceDetection();
    };
  })
  .catch(err => {
    status.textContent = "æ— æ³•è®¿é—®æ‘„åƒå¤´æˆ–éº¦å…‹é£";
    console.error(err);
  });

  function startFaceDetection() {
    const size = { width: camera.videoWidth, height: camera.videoHeight };
    faceapi.matchDimensions(overlay, size);

    setInterval(async () => {
      const detections = await faceapi.detectAllFaces(camera, new faceapi.TinyFaceDetectorOptions());
      context.clearRect(0, 0, overlay.width, overlay.height);

      if (detections.length > 0) {
        status.textContent = `çŠ¶æ€ï¼šæ£€æµ‹åˆ° ${detections.length} å¼ äººè„¸`;
        startButton.disabled = false;
      } else {
        status.textContent = "çŠ¶æ€ï¼šæœªæ£€æµ‹åˆ°äººè„¸";
        startButton.disabled = true;
      }

      const resized = faceapi.resizeResults(detections, size);
      faceapi.draw.drawDetections(overlay, resized);
    }, 300);
  }

  startButton.addEventListener('click', () => {
    mediaRecorder = new MediaRecorder(camera.srcObject);
    audioChunks = [];
    mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
    mediaRecorder.onstop = () => {
      const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
      audioElement.src = URL.createObjectURL(audioBlob);
    };
    mediaRecorder.start();
    startButton.disabled = true;
    stopButton.disabled = false;
    status.textContent = "çŠ¶æ€ï¼šæ­£åœ¨å½•éŸ³...";
  });

  stopButton.addEventListener('click', () => {
    mediaRecorder.stop();
    startButton.disabled = false;
    stopButton.disabled = true;
    status.textContent = "çŠ¶æ€ï¼šå½•éŸ³å·²åœæ­¢";
  });
</script>

</body>
</html>
